# HA Mode Configuration for RKE2 Server Nodes
# This config enables high availability with multiple server nodes

# permissions for generated kubeconfig
write-kubeconfig-mode: "0600"
# CNI plugin to use (default is flannel)
cni: cilium
# enable servicelb load balancer controller for bare metal installation
enable-servicelb: true
# apply extra security hardening profile to achieve CIS compliance
profile: cis
cluster-domain: cluster.local
disable-kube-proxy: "true"
# For HA mode with embedded etcd
# First server starts without this, subsequent servers join the cluster
# server: https://server-0:9345
# Alternatively, use external etcd for production HA:
# datastore-endpoint: "https://etcd-0:2379,https://etcd-1:2379,https://etcd-2:2379"
# datastore-cafile: /path/to/ca.crt
# datastore-certfile: /path/to/cert.crt
# datastore-keyfile: /path/to/key.pem
node-label+:
  # mark the node to allow using servicelb load balancer controller
  - "svccontroller.rke2.cattle.io/enablelb=true"
node-taint+:
  # prevent scheduling regular workloads on the server nodes in HA mode
  - "CriticalAddonsOnly=true:NoExecute"
tls-san+:
  - server.cluster.local
  - server-0.cluster.local
  - server-1.cluster.local
  - server-2.cluster.local
pod-security-admission-config-file: /etc/rancher/rke2/rke2-pss-override.yaml
